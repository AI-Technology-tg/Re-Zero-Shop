<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Collection & Analysis Platform</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .header h1 {
            color: #4a5568;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            color: #718096;
            font-size: 1.1rem;
        }

        .data-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .data-section h2 {
            color: #2d3748;
            margin-bottom: 20px;
            font-size: 1.8rem;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .data-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .data-card {
            background: #f7fafc;
            border-radius: 10px;
            padding: 20px;
            border-left: 4px solid #667eea;
        }

        .data-card h3 {
            color: #2d3748;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .data-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .data-item:last-child {
            border-bottom: none;
        }

        .data-label {
            font-weight: 600;
            color: #4a5568;
            flex: 1;
        }

        .data-value {
            color: #2d3748;
            background: #edf2f7;
            padding: 4px 8px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-width: 200px;
            word-break: break-all;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-item {
            background: #f7fafc;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid #e2e8f0;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #718096;
            font-size: 0.9rem;
        }

        .progress-section {
            background: #f7fafc;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .progress-bar {
            width: 100%;
            height: 25px;
            background: #e2e8f0;
            border-radius: 12px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 12px;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .export-section {
            background: #f7fafc;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .export-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn.json {
            background: #ed8936;
        }

        .btn.csv {
            background: #4299e1;
        }

        .btn.txt {
            background: #48bb78;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #48bb78;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .timeline {
            background: #f7fafc;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .timeline-item {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .timeline-time {
            color: #718096;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .timeline-title {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .timeline-description {
            color: #4a5568;
            font-size: 0.9rem;
        }

        .no-data {
            text-align: center;
            color: #718096;
            font-style: italic;
            padding: 20px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .data-grid {
                grid-template-columns: 1fr;
            }
            
            .export-buttons {
                flex-direction: column;
            }
            
            .data-item {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .data-value {
                max-width: 100%;
                margin-top: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üîç Data Collection Platform</h1>
            <p>–ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Telegram –∏ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</p>
        </div>

        <!-- Statistics -->
        <div class="data-section">
            <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö</h2>
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-number" id="telegramStats">0</div>
                    <div class="stat-label">Telegram –¥–∞–Ω–Ω—ã–µ</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="browserStats">0</div>
                    <div class="stat-label">–ë—Ä–∞—É–∑–µ—Ä –¥–∞–Ω–Ω—ã–µ</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="deviceStats">0</div>
                    <div class="stat-label">–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –¥–∞–Ω–Ω—ã–µ</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="locationStats">0</div>
                    <div class="stat-label">–õ–æ–∫–∞—Ü–∏—è –¥–∞–Ω–Ω—ã–µ</div>
                </div>
            </div>
            <div class="progress-section">
                <h3>–ü—Ä–æ–≥—Ä–µ—Å—Å —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö</h3>
                <div class="progress-bar">
                    <div class="progress-fill" id="dataProgress" style="width: 0%">0%</div>
                </div>
            </div>
        </div>

        <!-- Telegram Data -->
        <div class="data-section">
            <h2>üì± –î–∞–Ω–Ω—ã–µ –∏–∑ Telegram</h2>
            <div class="data-grid">
                <div class="data-card">
                    <h3>–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                    <div class="data-item">
                        <span class="data-label">ID:</span>
                        <span class="data-value" id="telegramId">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">–ò–º—è:</span>
                        <span class="data-value" id="telegramName">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">Username:</span>
                        <span class="data-value" id="telegramUsername">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">–Ø–∑—ã–∫:</span>
                        <span class="data-value" id="telegramLanguage">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">Premium:</span>
                        <span class="data-value" id="telegramPremium">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                </div>
                <div class="data-card">
                    <h3>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h3>
                    <div class="data-item">
                        <span class="data-label">–ë–æ—Ç:</span>
                        <span class="data-value" id="telegramIsBot">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">–ú–µ–Ω—é –≤–ª–æ–∂–µ–Ω–∏–π:</span>
                        <span class="data-value" id="telegramAttachmentMenu">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π:</span>
                        <span class="data-value" id="telegramInteractions">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">–ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:</span>
                        <span class="data-value" id="telegramLastActivity">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Chat Data -->
        <div class="data-section">
            <h2>üí¨ –î–∞–Ω–Ω—ã–µ —á–∞—Ç–∞</h2>
            <div class="data-grid">
                <div class="data-card">
                    <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —á–∞—Ç–µ</h3>
                    <div class="data-item">
                        <span class="data-label">ID —á–∞—Ç–∞:</span>
                        <span class="data-value" id="chatId">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">–¢–∏–ø —á–∞—Ç–∞:</span>
                        <span class="data-value" id="chatType">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">–ù–∞–∑–≤–∞–Ω–∏–µ:</span>
                        <span class="data-value" id="chatTitle">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">Username —á–∞—Ç–∞:</span>
                        <span class="data-value" id="chatUsername">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Browser Data -->
        <div class="data-section">
            <h2>üåê –î–∞–Ω–Ω—ã–µ –±—Ä–∞—É–∑–µ—Ä–∞</h2>
            <div class="data-grid">
                <div class="data-card">
                    <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±—Ä–∞—É–∑–µ—Ä–µ</h3>
                    <div class="data-item">
                        <span class="data-label">User Agent:</span>
                        <span class="data-value" id="userAgent">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">–Ø–∑—ã–∫:</span>
                        <span class="data-value" id="browserLanguage">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞:</span>
                        <span class="data-value" id="platform">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–∞:</span>
                        <span class="data-value" id="screenResolution">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">–í—Ä–µ–º–µ–Ω–Ω–∞—è –∑–æ–Ω–∞:</span>
                        <span class="data-value" id="timezone">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                </div>
                <div class="data-card">
                    <h3>–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ</h3>
                    <div class="data-item">
                        <span class="data-label">–¢–∏–ø —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:</span>
                        <span class="data-value" id="deviceType">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">–û–°:</span>
                        <span class="data-value" id="operatingSystem">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">–ë—Ä–∞—É–∑–µ—Ä:</span>
                        <span class="data-value" id="browserName">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">–í–µ—Ä—Å–∏—è –±—Ä–∞—É–∑–µ—Ä–∞:</span>
                        <span class="data-value" id="browserVersion">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">WebGL:</span>
                        <span class="data-value" id="webglSupport">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Location Data -->
        <div class="data-section">
            <h2>üìç –î–∞–Ω–Ω—ã–µ –æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–∏</h2>
            <div class="data-grid">
                <div class="data-card">
                    <h3>–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è</h3>
                    <div class="data-item">
                        <span class="data-label">IP –∞–¥—Ä–µ—Å:</span>
                        <span class="data-value" id="ipAddress">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">–°—Ç—Ä–∞–Ω–∞:</span>
                        <span class="data-value" id="country">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">–ì–æ—Ä–æ–¥:</span>
                        <span class="data-value" id="city">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã:</span>
                        <span class="data-value" id="coordinates">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">–ü—Ä–æ–≤–∞–π–¥–µ—Ä:</span>
                        <span class="data-value" id="isp">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bot Information -->
        <div class="data-section">
            <h2>ü§ñ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–æ—Ç–µ</h2>
            <div class="data-grid">
                <div class="data-card">
                    <h3>–î–∞–Ω–Ω—ã–µ –±–æ—Ç–∞</h3>
                    <div class="data-item">
                        <span class="data-label">Username –±–æ—Ç–∞:</span>
                        <span class="data-value" id="botUsername">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">–ò–º—è –±–æ—Ç–∞:</span>
                        <span class="data-value" id="botFirstName">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">–ú–æ–∂–µ—Ç –ø—Ä–∏—Å–æ–µ–¥–∏–Ω—è—Ç—å—Å—è –∫ –≥—Ä—É–ø–ø–∞–º:</span>
                        <span class="data-value" id="botCanJoinGroups">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">–ú–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è:</span>
                        <span class="data-value" id="botCanReadAllMessages">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç inline –∑–∞–ø—Ä–æ—Å—ã:</span>
                        <span class="data-value" id="botSupportsInline">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Timeline -->
        <div class="data-section">
            <h2>‚è∞ –í—Ä–µ–º–µ–Ω–Ω–∞—è –ª–∏–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</h2>
            <div class="timeline" id="activityTimeline">
                <div class="no-data">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏...</div>
            </div>
        </div>

        <!-- Export Section -->
        <div class="data-section">
            <h2>üì§ –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h2>
            <p>–°–∫–∞—á–∞–π—Ç–µ –≤—Å–µ —Å–æ–±—Ä–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–∞—Ö:</p>
            <div class="export-buttons">
                <button class="btn json" onclick="exportData('json')">üìÑ JSON</button>
                <button class="btn csv" onclick="exportData('csv')">üìä CSV</button>
                <button class="btn txt" onclick="exportData('txt')">üìù TXT</button>
                <button class="btn" onclick="printData()">üñ®Ô∏è –ü–µ—á–∞—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification">
        <span id="notificationText">–î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã!</span>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö
        let collectedData = {
            telegram: {},
            browser: {},
            device: {},
            location: {},
            bot: {},
            timeline: []
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        let tg = window.Telegram.WebApp;
        if (tg) {
            tg.ready();
            tg.expand();
        }

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        function showNotification(message) {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            notificationText.textContent = message;
            notification.classList.add('show');
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –±—Ä–∞—É–∑–µ—Ä–∞
        function collectBrowserData() {
            const userAgent = navigator.userAgent;
            
            // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –±—Ä–∞—É–∑–µ—Ä–∞
            let browserName = 'Unknown';
            let browserVersion = 'Unknown';
            if (userAgent.includes('Chrome')) {
                browserName = 'Chrome';
                browserVersion = userAgent.match(/Chrome\/(\d+)/)?.[1] || 'Unknown';
            } else if (userAgent.includes('Firefox')) {
                browserName = 'Firefox';
                browserVersion = userAgent.match(/Firefox\/(\d+)/)?.[1] || 'Unknown';
            } else if (userAgent.includes('Safari')) {
                browserName = 'Safari';
                browserVersion = userAgent.match(/Version\/(\d+)/)?.[1] || 'Unknown';
            } else if (userAgent.includes('Edge')) {
                browserName = 'Edge';
                browserVersion = userAgent.match(/Edge\/(\d+)/)?.[1] || 'Unknown';
            }

            // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –û–°
            let operatingSystem = 'Unknown';
            if (userAgent.includes('Windows')) operatingSystem = 'Windows';
            else if (userAgent.includes('Mac')) operatingSystem = 'macOS';
            else if (userAgent.includes('Linux')) operatingSystem = 'Linux';
            else if (userAgent.includes('Android')) operatingSystem = 'Android';
            else if (userAgent.includes('iOS')) operatingSystem = 'iOS';

            // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
            let deviceType = 'Desktop';
            if (userAgent.includes('Mobile')) deviceType = 'Mobile';
            else if (userAgent.includes('Tablet')) deviceType = 'Tablet';

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ WebGL
            let webglSupport = 'No';
            try {
                const canvas = document.createElement('canvas');
                const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                if (gl) webglSupport = 'Yes';
            } catch (e) {
                webglSupport = 'No';
            }

            return {
                userAgent: userAgent,
                language: navigator.language,
                platform: navigator.platform,
                screenWidth: screen.width,
                screenHeight: screen.height,
                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                browserName,
                browserVersion,
                operatingSystem,
                deviceType,
                webglSupport,
                timestamp: new Date().toISOString()
            };
        }

        // –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö Telegram Web App
        function collectTelegramData() {
            if (tg && tg.initDataUnsafe) {
                const user = tg.initDataUnsafe.user;
                if (user) {
                    return {
                        id: user.id,
                        firstName: user.first_name,
                        lastName: user.last_name,
                        username: user.username,
                        languageCode: user.language_code,
                        isPremium: user.is_premium || false,
                        isBot: user.is_bot || false,
                        addedToAttachmentMenu: user.added_to_attachment_menu || false
                    };
                }
            }
            return {};
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ IP –∏ –ª–æ–∫–∞—Ü–∏–∏
        async function collectLocationData() {
            try {
                const response = await fetch('https://ipapi.co/json/');
                const data = await response.json();
                return {
                    ip: data.ip,
                    city: data.city,
                    region: data.region,
                    country: data.country_name,
                    countryCode: data.country_code,
                    latitude: data.latitude,
                    longitude: data.longitude,
                    timezone: data.timezone,
                    isp: data.org,
                    asn: data.asn
                };
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ª–æ–∫–∞—Ü–∏–∏:', error);
                return {
                    ip: '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å',
                    city: '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å',
                    country: '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å',
                    error: error.message
                };
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        function updateUI() {
            // Telegram –¥–∞–Ω–Ω—ã–µ
            if (collectedData.telegram.id) {
                document.getElementById('telegramId').textContent = collectedData.telegram.id;
                document.getElementById('telegramName').textContent = `${collectedData.telegram.firstName || ''} ${collectedData.telegram.lastName || ''}`.trim();
                document.getElementById('telegramUsername').textContent = collectedData.telegram.username || '–ù–µ —É–∫–∞–∑–∞–Ω';
                document.getElementById('telegramLanguage').textContent = collectedData.telegram.languageCode || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω';
                document.getElementById('telegramPremium').textContent = collectedData.telegram.isPremium ? '–î–∞' : '–ù–µ—Ç';
                document.getElementById('telegramIsBot').textContent = collectedData.telegram.isBot ? '–î–∞' : '–ù–µ—Ç';
                document.getElementById('telegramAttachmentMenu').textContent = collectedData.telegram.addedToAttachmentMenu ? '–î–∞' : '–ù–µ—Ç';
                document.getElementById('telegramInteractions').textContent = collectedData.telegram.interaction_count || '0';
                document.getElementById('telegramLastActivity').textContent = collectedData.telegram.last_activity || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ';
            }

            // –î–∞–Ω–Ω—ã–µ —á–∞—Ç–∞
            if (collectedData.telegram.chat_id) {
                document.getElementById('chatId').textContent = collectedData.telegram.chat_id;
                document.getElementById('chatType').textContent = collectedData.telegram.chat_type;
                document.getElementById('chatTitle').textContent = collectedData.telegram.chat_title || '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
                document.getElementById('chatUsername').textContent = collectedData.telegram.chat_username || '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
            }

            // –ë—Ä–∞—É–∑–µ—Ä –¥–∞–Ω–Ω—ã–µ
            if (collectedData.browser.userAgent) {
                document.getElementById('userAgent').textContent = collectedData.browser.userAgent.substring(0, 50) + '...';
                document.getElementById('browserLanguage').textContent = collectedData.browser.language;
                document.getElementById('platform').textContent = collectedData.browser.platform;
                document.getElementById('screenResolution').textContent = `${collectedData.browser.screenWidth}x${collectedData.browser.screenHeight}`;
                document.getElementById('timezone').textContent = collectedData.browser.timezone;
                document.getElementById('deviceType').textContent = collectedData.browser.deviceType;
                document.getElementById('operatingSystem').textContent = collectedData.browser.operatingSystem;
                document.getElementById('browserName').textContent = collectedData.browser.browserName;
                document.getElementById('browserVersion').textContent = collectedData.browser.browserVersion;
                document.getElementById('webglSupport').textContent = collectedData.browser.webglSupport;
            }

            // –õ–æ–∫–∞—Ü–∏—è –¥–∞–Ω–Ω—ã–µ
            if (collectedData.location.ip) {
                document.getElementById('ipAddress').textContent = collectedData.location.ip;
                document.getElementById('country').textContent = collectedData.location.country;
                document.getElementById('city').textContent = collectedData.location.city;
                document.getElementById('coordinates').textContent = `${collectedData.location.latitude}, ${collectedData.location.longitude}`;
                document.getElementById('isp').textContent = collectedData.location.isp;
            }

            // –î–∞–Ω–Ω—ã–µ –±–æ—Ç–∞
            if (collectedData.telegram.bot_info) {
                document.getElementById('botUsername').textContent = collectedData.telegram.bot_info.bot_username || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ';
                document.getElementById('botFirstName').textContent = collectedData.telegram.bot_info.bot_first_name || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ';
                document.getElementById('botCanJoinGroups').textContent = collectedData.telegram.bot_info.bot_can_join_groups ? '–î–∞' : '–ù–µ—Ç';
                document.getElementById('botCanReadAllMessages').textContent = collectedData.telegram.bot_info.bot_can_read_all_group_messages ? '–î–∞' : '–ù–µ—Ç';
                document.getElementById('botSupportsInline').textContent = collectedData.telegram.bot_info.bot_supports_inline_queries ? '–î–∞' : '–ù–µ—Ç';
            }

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            updateStats();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStats() {
            let telegramCount = Object.keys(collectedData.telegram).length;
            let browserCount = Object.keys(collectedData.browser).length;
            let deviceCount = Object.keys(collectedData.device).length;
            let locationCount = Object.keys(collectedData.location).length;

            document.getElementById('telegramStats').textContent = telegramCount;
            document.getElementById('browserStats').textContent = browserCount;
            document.getElementById('deviceStats').textContent = deviceCount;
            document.getElementById('locationStats').textContent = locationCount;

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞
            const totalData = telegramCount + browserCount + deviceCount + locationCount;
            const maxData = 50;
            const progress = Math.min((totalData / maxData) * 100, 100);
            document.getElementById('dataProgress').style.width = progress + '%';
            document.getElementById('dataProgress').textContent = Math.round(progress) + '%';
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –≤—Ä–µ–º–µ–Ω–Ω—É—é –ª–∏–Ω–∏—é
        function addToTimeline(title, description, type = 'info') {
            const timelineItem = {
                title,
                description,
                type,
                timestamp: new Date().toISOString()
            };

            collectedData.timeline.push(timelineItem);
            updateTimeline();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –ª–∏–Ω–∏–∏
        function updateTimeline() {
            const timeline = document.getElementById('activityTimeline');
            timeline.innerHTML = '';

            if (collectedData.timeline.length === 0) {
                timeline.innerHTML = '<div class="no-data">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</div>';
                return;
            }

            collectedData.timeline.forEach(item => {
                const timelineElement = document.createElement('div');
                timelineElement.className = 'timeline-item';
                timelineElement.innerHTML = `
                    <div class="timeline-time">${new Date(item.timestamp).toLocaleString('ru-RU')}</div>
                    <div class="timeline-title">${item.title}</div>
                    <div class="timeline-description">${item.description}</div>
                `;
                timeline.appendChild(timelineElement);
            });
        }

        // –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
        function exportData(format) {
            const allData = {
                ...collectedData,
                exportTimestamp: new Date().toISOString(),
                totalDataPoints: Object.keys(collectedData).length
            };

            let content, filename, mimeType;

            switch (format) {
                case 'json':
                    content = JSON.stringify(allData, null, 2);
                    filename = `user-data-${Date.now()}.json`;
                    mimeType = 'application/json';
                    break;
                case 'csv':
                    content = convertToCSV(allData);
                    filename = `user-data-${Date.now()}.csv`;
                    mimeType = 'text/csv';
                    break;
                case 'txt':
                    content = convertToText(allData);
                    filename = `user-data-${Date.now()}.txt`;
                    mimeType = 'text/plain';
                    break;
            }

            downloadFile(content, filename, mimeType);
            showNotification(`–î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ ${format.toUpperCase()}!`);
        }

        // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ CSV
        function convertToCSV(data) {
            let csv = '–¢–∏–ø –¥–∞–Ω–Ω—ã—Ö,–ü–æ–ª–µ,–ó–Ω–∞—á–µ–Ω–∏–µ\n';
            
            Object.keys(data).forEach(category => {
                if (typeof data[category] === 'object' && data[category] !== null) {
                    Object.keys(data[category]).forEach(key => {
                        csv += `${category},${key},"${data[category][key]}"\n`;
                    });
                }
            });
            
            return csv;
        }

        // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ —Ç–µ–∫—Å—Ç
        function convertToText(data) {
            let text = '–°–û–ë–†–ê–ù–ù–´–ï –î–ê–ù–ù–´–ï –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø\n';
            text += '='.repeat(50) + '\n\n';
            
            Object.keys(data).forEach(category => {
                text += `${category.toUpperCase()}:\n`;
                text += '-'.repeat(20) + '\n';
                
                if (typeof data[category] === 'object' && data[category] !== null) {
                    Object.keys(data[category]).forEach(key => {
                        text += `${key}: ${data[category][key]}\n`;
                    });
                }
                text += '\n';
            });
            
            return text;
        }

        // –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
        function downloadFile(content, filename, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // –ü–µ—á–∞—Ç—å –¥–∞–Ω–Ω—ã—Ö
        function printData() {
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                    <head>
                        <title>–°–æ–±—Ä–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</title>
                        <style>
                            body { font-family: Arial, sans-serif; margin: 20px; }
                            h1 { color: #333; }
                            .section { margin: 20px 0; }
                            .data-item { margin: 10px 0; }
                            .label { font-weight: bold; }
                        </style>
                    </head>
                    <body>
                        <h1>–°–æ–±—Ä–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h1>
                        ${generatePrintContent()}
                    </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è –ø–µ—á–∞—Ç–∏
        function generatePrintContent() {
            let content = '';
            Object.keys(collectedData).forEach(category => {
                content += `<div class="section"><h2>${category.toUpperCase()}</h2>`;
                if (typeof collectedData[category] === 'object' && collectedData[category] !== null) {
                    Object.keys(collectedData[category]).forEach(key => {
                        content += `<div class="data-item"><span class="label">${key}:</span> ${collectedData[category][key]}</div>`;
                    });
                }
                content += '</div>';
            });
            return content;
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        async function initialize() {
            showNotification('–ù–∞—á–∏–Ω–∞–µ–º —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö...');

            // –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –∏–∑ URL –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (–æ—Ç Telegram –±–æ—Ç–∞)
            const urlParams = new URLSearchParams(window.location.search);
            const telegramDataParam = urlParams.get('data');
            if (telegramDataParam) {
                try {
                    const decodedData = JSON.parse(atob(telegramDataParam));
                    collectedData.telegram = decodedData;
                    addToTimeline('Telegram –¥–∞–Ω–Ω—ã–µ', '–ü–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –æ—Ç Telegram –±–æ—Ç–∞', 'telegram');
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö Telegram:', error);
                }
            }

            // –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö Telegram Web App
            const telegramData = collectTelegramData();
            if (Object.keys(telegramData).length > 0) {
                collectedData.telegram = { ...collectedData.telegram, ...telegramData };
                addToTimeline('Telegram Web App', '–ü–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –æ—Ç Telegram Web App', 'telegram');
            }

            // –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –±—Ä–∞—É–∑–µ—Ä–∞
            collectedData.browser = collectBrowserData();
            addToTimeline('–ë—Ä–∞—É–∑–µ—Ä –¥–∞–Ω–Ω—ã–µ', '–°–æ–±—Ä–∞–Ω—ã –¥–∞–Ω–Ω—ã–µ –±—Ä–∞—É–∑–µ—Ä–∞ –∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞', 'browser');

            // –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
            collectedData.device = {
                deviceType: collectedData.browser.deviceType,
                operatingSystem: collectedData.browser.operatingSystem,
                browserName: collectedData.browser.browserName,
                browserVersion: collectedData.browser.browserVersion,
                webglSupport: collectedData.browser.webglSupport
            };

            // –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –ª–æ–∫–∞—Ü–∏–∏
            try {
                collectedData.location = await collectLocationData();
                addToTimeline('–õ–æ–∫–∞—Ü–∏—è –¥–∞–Ω–Ω—ã–µ', '–ü–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–∏', 'location');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ª–æ–∫–∞—Ü–∏–∏:', error);
                addToTimeline('–û—à–∏–±–∫–∞ –ª–æ–∫–∞—Ü–∏–∏', '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–∏', 'error');
            }

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
            updateUI();
            showNotification('–°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –∑–∞–≤–µ—Ä—à–µ–Ω!');
        }

        // –ó–∞–ø—É—Å–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
        document.addEventListener('DOMContentLoaded', initialize);
    </script>
</body>
</html>
